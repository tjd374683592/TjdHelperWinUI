<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="TjdHelperWinUI.Pages.RichEditPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:converter="using:TjdHelperWinUI.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:TjdHelperWinUI.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <converter:PrefixSuffixConverter x:Key="PrefixSuffixConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <!--  命令栏行  -->
            <RowDefinition Height="Auto" />
            <!--  内容区域行  -->
            <RowDefinition Height="*" />
            <!--  通知区域行  -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  TabbedCommandBar（带选项卡的命令栏）  -->
        <controls:TabbedCommandBar
            x:Name="CommandBar"
            Grid.Row="0"
            SelectionChanged="CommandBar_SelectionChanged">
            <controls:TabbedCommandBar.MenuItems>

                <!--  文本编辑选项卡  -->
                <controls:TabbedCommandBarItem x:Name="TextEditTab" Header="Text Edit">
                    <!--  撤销按钮  -->
                    <AppBarButton Command="{Binding UndoCommand}" Label="Undo">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE7A7;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <!--  重做按钮  -->
                    <AppBarButton Command="{Binding RedoCommand}" Label="Redo">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE7A6;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <!--  粘贴按钮  -->
                    <AppBarButton Command="{Binding PasteCommand}" Label="Paste">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE77F;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <AppBarSeparator />

                    <!--  新增：保存按钮  -->
                    <AppBarButton
                        x:Name="SaveTextButton"
                        Command="{Binding SaveCommand}"
                        Label="Save">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE74E;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <!--  新增：另存为按钮  -->
                    <AppBarButton
                        x:Name="SaveAsTextButton"
                        Command="{Binding SaveAsCommand}"
                        Label="Save As">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE792;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <AppBarSeparator />

                    <!--  字体选择下拉框  -->
                    <AppBarElementContainer>
                        <ComboBox
                            x:Name="FontCombo"
                            MinWidth="175"
                            SelectedValue="{Binding SelectedFont, Mode=TwoWay}"
                            SelectedValuePath="Content">
                            <ComboBoxItem Content="Arial" />
                            <ComboBoxItem Content="Calibri" />
                            <ComboBoxItem Content="JetBrains Mono" />
                            <ComboBoxItem Content="Roboto" />
                            <ComboBoxItem Content="Segoe UI" />
                            <ComboBoxItem Content="Segoe UI Semibold" />
                        </ComboBox>
                    </AppBarElementContainer>

                    <!--  字号输入框  -->
                    <AppBarElementContainer>
                        <TextBox
                            x:Name="FontSizeBox"
                            KeyDown="FontSizeBox_KeyDown"
                            PlaceholderText="Font Size"
                            Text="{Binding FontSize, Mode=TwoWay}" />
                    </AppBarElementContainer>

                    <!--  加粗按钮  -->
                    <AppBarToggleButton
                        x:Name="BoldButton"
                        IsChecked="{Binding IsBold, Mode=TwoWay}"
                        Label="Bold">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE8DD;" />
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>

                    <!--  斜体按钮  -->
                    <AppBarToggleButton
                        x:Name="ItalicButton"
                        IsChecked="{Binding IsItalic, Mode=TwoWay}"
                        Label="Italic">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE8DB;" />
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>

                    <!--  下划线按钮  -->
                    <AppBarToggleButton
                        x:Name="UnderlineButton"
                        IsChecked="{Binding IsUnderline, Mode=TwoWay}"
                        Label="Underline">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE8DC;" />
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>
                </controls:TabbedCommandBarItem>

                <!--  图片裁剪选项卡  -->
                <controls:TabbedCommandBarItem x:Name="ImageCropTab" Header="Image Crop">
                    <!--  选择图片按钮  -->
                    <AppBarButton
                        x:Name="PickButton"
                        Click="PickButton_Click"
                        Label="Pick Image">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE91B;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <!--  保存按钮  -->
                    <AppBarButton
                        x:Name="SaveButton"
                        Click="SaveButton_Click"
                        Label="Save">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE74E;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <!--  重置按钮  -->
                    <AppBarButton
                        x:Name="ResetButton"
                        Click="ResetButton_Click"
                        Label="Reset">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE72C;" />
                        </AppBarButton.Icon>
                    </AppBarButton>

                    <AppBarSeparator />

                    <!--  拖动手柄位置下拉框  -->
                    <AppBarElementContainer>
                        <ComboBox
                            x:Name="ThumbPlacementCombo"
                            Width="150"
                            SelectedIndex="0"
                            SelectionChanged="ThumbPlacementCombo_SelectionChanged">
                            <ComboBoxItem Content="All" />
                            <ComboBoxItem Content="Corners" />
                        </ComboBox>
                    </AppBarElementContainer>

                    <!--  裁剪形状下拉框  -->
                    <AppBarElementContainer>
                        <ComboBox
                            x:Name="CropShapeCombo"
                            Width="150"
                            SelectedIndex="0"
                            SelectionChanged="CropShapeCombo_SelectionChanged">
                            <ComboBoxItem Content="Rectangular" />
                            <ComboBoxItem Content="Circular" />
                        </ComboBox>
                    </AppBarElementContainer>

                    <!--  宽高比下拉框  -->
                    <AppBarElementContainer>
                        <ComboBox
                            x:Name="AspectRatioCombo"
                            Width="150"
                            SelectedIndex="0"
                            SelectionChanged="AspectRatioCombo_SelectionChanged">
                            <ComboBoxItem Content="Custom" />
                            <ComboBoxItem Content="Square" />
                            <ComboBoxItem Content="Landscape(16:9)" />
                            <ComboBoxItem Content="Portrait(9:16)" />
                            <ComboBoxItem Content="4:3" />
                            <ComboBoxItem Content="3:2" />
                        </ComboBox>
                    </AppBarElementContainer>
                </controls:TabbedCommandBarItem>
            </controls:TabbedCommandBar.MenuItems>
        </controls:TabbedCommandBar>

        <!--  内容区域  -->
        <Grid Grid.Row="1" Margin="5">
            <!--  文本编辑框  -->
            <RichEditBox
                x:Name="Editor"
                AcceptsReturn="True"
                AllowDrop="True"
                DragOver="Editor_DragOver"
                Drop="Editor_Drop"
                LostFocus="Editor_LostFocused"
                PointerWheelChanged="Editor_PointerWheelChanged"
                TextWrapping="Wrap" />

            <!--  图片裁剪控件  -->
            <controls:ImageCropper
                x:Name="ImageCropperControl"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                AspectRatio="0"
                CornerRadius="5"
                CropShape="Rectangular"
                ThumbPlacement="All"
                Visibility="Collapsed" />
        </Grid>

        <!--  通知区域  -->
        <Grid Grid.Row="2" Margin="0,0,0,5">
            <controls:MarqueeText
                Name="marqueeTextNotification"
                Direction="Left"
                FontSize="16"
                RepeatBehavior="Forever"
                Speed="96"
                Text="{Binding CurrentFile.Path, Converter={StaticResource PrefixSuffixConverter}, ConverterParameter='Save to: {0}'}" />
        </Grid>
    </Grid>
</Page>