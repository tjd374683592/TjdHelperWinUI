<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>

    <style>
        html, body, #editor {
            margin: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

            body.drag-over {
                position: relative;
                background: radial-gradient( circle at center, rgba(80, 160, 255, 0.10), rgba(10, 15, 20, 0.02) 60% );
            }

                body.drag-over::before {
                    content: "üìÑ  ÈáäÊîæ‰ª•ÊâìÂºÄÊñá‰ª∂";
                    position: absolute;
                    inset: 0;
                    margin: auto;
                    width: max-content;
                    height: max-content;
                    padding: 14px 28px;
                    font-size: 14.5px;
                    font-weight: 500;
                    letter-spacing: 0.35px;
                    color: rgba(235, 245, 255, 0.92);
                    background: linear-gradient( 180deg, rgba(40, 48, 60, 0.85), rgba(28, 34, 44, 0.85) );
                    border-radius: 12px;
                    border: 1px solid rgba(120, 200, 255, 0.35);
                    backdrop-filter: blur(10px) saturate(140%);
                    -webkit-backdrop-filter: blur(10px) saturate(140%);
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.45), inset 0 1px 0 rgba(255, 255, 255, 0.06);
                    pointer-events: none;
                    z-index: 9999;
                    animation: dragPulseModern 1.6s ease-in-out infinite;
                }

        @keyframes dragPulseModern {
            0% {
                opacity: 0.9;
                transform: scale(0.985);
                border-color: rgba(120, 200, 255, 0.25);
            }

            50% {
                opacity: 1;
                transform: scale(1);
                border-color: rgba(160, 220, 255, 0.45);
            }

            100% {
                opacity: 0.9;
                transform: scale(0.985);
                border-color: rgba(120, 200, 255, 0.25);
            }
        }



        /* ===== ÊêúÁ¥¢Êï¥Ë°åÈ´ò‰∫Æ ===== */
        .myLineHighlight {
            background-color: #FFFF00;
        }

        .myLineHighlightText {
            color: black !important;
        }
    </style>
</head>

<body>
    <div id="editor"></div>

    <script>
        require.config({
            paths: {
                'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs'
            }
        });

        let editor;
        let currentTheme = "vs-dark";

        require(["vs/editor/editor.main"], function () {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: ``,
                language: "json",
                wordWrap: "on",
                theme: currentTheme
            });

            window.addEventListener('resize', () => {
                editor && editor.layout();
            });
        });

        /* ===== ÊãñÊãΩÈÄªËæëÔºàÈò≤Èó™ÁÉÅÔºâ ===== */
        let dragCounter = 0;

        window.addEventListener('dragenter', e => {
            e.preventDefault();
            dragCounter++;
            if (dragCounter === 1) {
                document.body.classList.add('drag-over');
            }
        });

        window.addEventListener('dragleave', e => {
            e.preventDefault();
            dragCounter--;
            if (dragCounter === 0) {
                document.body.classList.remove('drag-over');
            }
        });

        window.addEventListener('dragover', e => {
            e.preventDefault();
        });

        window.addEventListener('drop', e => {
            e.preventDefault();
            dragCounter = 0;
            document.body.classList.remove('drag-over');
            // TODO: Â§ÑÁêÜÊñá‰ª∂ÂÜÖÂÆπ
        });

        /* ===== WebView2 Êé•Âè£ ===== */
        function setEditorLanguage(lang) {
            monaco.editor.setModelLanguage(editor.getModel(), lang);
        }

        function setEditorContent(content) {
            editor && editor.setValue(content);
        }

        function formatCode() {
            editor && editor.getAction('editor.action.formatDocument').run();
        }

        function setEditorTheme(theme) {
            if (editor) {
                monaco.editor.setTheme(theme);
                currentTheme = theme;
            }
        }

        function getEditorTheme() {
            return currentTheme;
        }

        /* ===== ÊêúÁ¥¢Êï¥Ë°åÈ´ò‰∫Æ ===== */
        let lineHighlightDecorations = [];

        function highlightSearchLines(keyword) {
            const model = editor.getModel();
            if (!model) return;

            if (lineHighlightDecorations.length > 0) {
                lineHighlightDecorations =
                    editor.deltaDecorations(lineHighlightDecorations, []);
            }

            if (!keyword || keyword.trim() === "") return;

            const matches = model.findMatches(keyword, true, false, false, null, true);

            const newDecorations = matches.map(m => {
                const line = m.range.startLineNumber;
                return {
                    range: new monaco.Range(
                        line,
                        1,
                        line,
                        model.getLineMaxColumn(line)
                    ),
                    options: {
                        isWholeLine: true,
                        className: "myLineHighlight",
                        inlineClassName: "myLineHighlightText"
                    }
                };
            });

            lineHighlightDecorations =
                editor.deltaDecorations([], newDecorations);
        }
    </script>
</body>
</html>
